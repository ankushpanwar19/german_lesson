<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Vocabulary Practice - Level 1</title>
    
    <!-- CDN Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    
    <style>
        /* 
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        PERSONALIZATION PLACEHOLDERS - REPLACE THESE IN THE HTML/JS BELOW:
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        [YOUR_NAME] - Your name (appears in messages)
        [WIFE_NAME] - Your wife's name (used in proposal)
        
        DATE DETAILS (in Phase 3 HTML):
        [RESTAURANT_NAME] - Name of the Zurich restaurant
        [DATE_TIME] - Date and time of reservation
        [MAP_LINK] - Google Maps link to restaurant
        
        LOVE LETTER (in Phase 3 HTML):
        [YOUR_LOVE_MESSAGE] - Your personal love letter text (can be multiple lines)
        
        AUDIO (optional, in JavaScript):
        [BACKGROUND_MUSIC_URL] - URL to romantic background music MP3
        [SUCCESS_SOUND_URL] - URL to success chime sound
        
        NOTE: Phase 1 uses German vocabulary questions (Das Herz, FÃ¼r immer)
              to maintain the surprise before the Valentine proposal!
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        */
        
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FFE5E5 0%, #FFC0CB 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }

        /* Floating Hearts Background */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        .floating-hearts.show {
            opacity: 1;
        }

        .heart {
            position: absolute;
            bottom: -50px;
            font-size: 35px;
            color: rgba(255, 105, 180, 0.7);
            animation: floatUp 15s infinite ease-in;
        }

        .heart:nth-child(2n) {
            animation-duration: 12s;
            font-size: 28px;
            color: rgba(255, 20, 147, 0.6);
        }

        .heart:nth-child(3n) {
            animation-duration: 18s;
            font-size: 40px;
            color: rgba(255, 182, 193, 0.6);
        }

        .heart:nth-child(4n) {
            animation-duration: 16s;
            font-size: 32px;
            color: rgba(255, 105, 180, 0.65);
        }

        /* Flowers */
        .flower {
            position: absolute;
            bottom: -50px;
            font-size: 30px;
            animation: floatUpFlower 14s infinite ease-in-out;
        }

        .flower:nth-child(2n) {
            animation-duration: 17s;
            font-size: 25px;
        }

        .flower:nth-child(3n) {
            animation-duration: 13s;
            font-size: 35px;
        }

        .flower:nth-child(5n) {
            animation-duration: 19s;
            font-size: 28px;
        }

        @keyframes floatUp {
            0% {
                bottom: -50px;
                transform: translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                bottom: 110vh;
                transform: translateX(calc(var(--drift) * 100px)) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes floatUpFlower {
            0% {
                bottom: -50px;
                transform: translateX(0) rotate(0deg) scale(1);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            50% {
                transform: translateX(calc(var(--drift) * 80px)) rotate(180deg) scale(1.1);
            }
            90% {
                opacity: 1;
            }
            100% {
                bottom: 110vh;
                transform: translateX(calc(var(--drift) * 100px)) rotate(360deg) scale(0.9);
                opacity: 0;
            }
        }

        .container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
            padding: 20px 0;
        }

        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            padding: 40px 50px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        /* Adjust Phase 2 to fit GIF properly */
        #phase2 {
            margin: -40px -50px;
            padding: 0;
        }
        
        #phase2 .question {
            padding: 0 50px 20px 50px;
        }
        
        #phase2 .hint-message {
            padding: 0 50px;
        }
        
        #phase2 .button-container {
            padding: 0 50px 40px 50px;
        }

        /* Smooth scrolling */
        .card::-webkit-scrollbar {
            width: 8px;
        }

        .card::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .card::-webkit-scrollbar-thumb {
            background: #FFB6C1;
            border-radius: 10px;
        }

        .card::-webkit-scrollbar-thumb:hover {
            background: #FF69B4;
        }

        h1 {
            color: #FF1493;
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 600;
        }

        .question {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Adjust spacing for proposal question */
        #phase2 .question {
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .options {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: nowrap;
            margin-top: 20px;
            align-items: center;
        }
        
        #phase2 .options {
            gap: 30px;
        }

        button {
            padding: 15px 40px;
            font-size: 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            min-width: 150px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .option-btn {
            background: #f0f0f0;
            color: #333;
        }

        .option-btn:hover {
            background: #e0e0e0;
        }

        .ja-btn {
            background: linear-gradient(135deg, #00C853 0%, #00E676 100%);
            color: white;
        }

        .ja-btn:hover {
            background: linear-gradient(135deg, #00E676 0%, #00C853 100%);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 200, 83, 0.4);
        }

        .nein-btn {
            background: linear-gradient(135deg, #FF1744 0%, #FF5252 100%);
            color: white;
            transition: transform 0.3s ease, box-shadow 0.1s ease;
        }

        .nein-btn.shrinking {
            animation: shrinkPulse 0.3s ease;
        }

        @keyframes shrinkPulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* Speech bubble for buttons */
        .speech-bubble {
            position: fixed;
            background: white;
            color: #FF1744;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            transform: translateY(0) translateX(-50%);
            transition: opacity 0.1s, background 0.1s;
            white-space: nowrap;
        }

        .speech-bubble.show {
            opacity: 1;
            transform: translateY(0) translateX(-50%);
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid currentColor;
            opacity: 0.3;
        }

        /* Hint message */
        .hint-message {
            margin-top: 20px;
            font-size: 16px;
            color: #FF1493;
            font-style: italic;
            min-height: 25px;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .hint-message.show {
            opacity: 1;
        }

        /* Phase visibility */
        .phase {
            display: none;
        }

        .phase.active {
            display: block;
        }

        /* Loading animation */
        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #FFE5E5;
            border-top: 5px solid #FF1493;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #FF1493;
            font-size: 18px;
            font-weight: 500;
        }

        /* Fade animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Success phase */
        .success-content {
            max-width: 100%;
        }

        .success-image {
            width: 100%;
            max-width: 350px;
            height: 250px;
            border-radius: 15px;
            margin: 15px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .success-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .success-message {
            font-size: 24px;
            color: #FF1493;
            font-weight: 700;
            margin-top: 15px;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        /* Love letter */
        .love-letter-container {
            margin-top: 25px;
            margin-bottom: 20px;
            display: none;
        }

        .love-letter-container.show {
            display: block;
            animation: unfold 1s ease-out;
        }

        @keyframes unfold {
            0% {
                opacity: 0;
                transform: scaleY(0);
            }
            50% {
                opacity: 0.5;
                transform: scaleY(0.5);
            }
            100% {
                opacity: 1;
                transform: scaleY(1);
            }
        }

        .love-letter {
            background: #FFFAF0;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            font-family: 'Dancing Script', cursive;
            font-size: 20px;
            color: #8B4513;
            line-height: 1.6;
            text-align: center;
        }

        .one-more-thing {
            font-size: 18px;
            color: #FF1493;
            font-style: italic;
            margin-top: 25px;
            margin-bottom: 10px;
            display: none;
        }

        /* Audio controls */
        .audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .mute-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #FF1493;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .mute-btn:hover {
            background: #FF1493;
            transform: scale(1.1);
        }

        /* Physics canvas - Hidden */
        #physics-canvas {
            display: none;
        }

        /* Button container for phase 2 */
        .button-container {
            position: relative;
            min-height: 80px;
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* GIF container for Phase 2 */
        .gif-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .gif-container .bubu-gif {
            width: 100%;
            max-width: 300px;
            height: auto;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
            border-radius: 15px;
        }

        .gif-container .bubu-gif.hidden {
            opacity: 0;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }

            .container {
                padding: 10px 0;
            }

            .card {
                padding: 25px 20px;
                width: 95%;
                max-height: 95vh;
                max-width: 95%;
            }
            
            h1 {
                font-size: 22px;
                margin-bottom: 15px;
            }
            
            .question {
                font-size: 18px;
                min-height: 30px;
                margin-bottom: 15px;
            }
            
            button {
                min-width: 110px;
                padding: 12px 25px;
                font-size: 15px;
            }

            .success-image {
                max-width: 100%;
                height: 200px;
                margin: 10px auto;
            }

            .success-message {
                font-size: 20px;
                margin-top: 10px;
                margin-bottom: 15px;
            }

            .love-letter {
                padding: 15px;
                font-size: 18px;
                line-height: 1.5;
            }

            .love-letter-container {
                margin-top: 15px;
                margin-bottom: 10px;
            }

            .hint-message {
                font-size: 14px;
            }

            .speech-bubble {
                font-size: 14px;
                padding: 8px 15px;
            }

            .audio-controls {
                top: 10px;
                right: 10px;
            }

            .mute-btn {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .gif-container {
                max-width: 225px;
            }
            
            .gif-container .bubu-gif {
                max-width: 225px;
            }

            #phase2 {
                margin: -25px -20px;
                padding: 0;
            }
            
            #phase2 .question {
                padding: 0 20px 15px 20px;
                margin-top: 10px;
            }
            
            #phase2 .hint-message {
                padding: 0 20px;
            }
            
            #phase2 .button-container {
                padding: 0 20px 25px 20px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 20px 15px;
            }

            h1 {
                font-size: 20px;
            }

            .question {
                font-size: 16px;
            }

            .options {
                gap: 12px;
            }

            button {
                min-width: 100px;
                padding: 10px 20px;
                font-size: 14px;
            }

            .success-image {
                height: 180px;
            }

            .success-message {
                font-size: 18px;
            }

            .date-details h3 {
                font-size: 16px;
            }

            .date-info {
                font-size: 13px;
            }

            .love-letter {
                font-size: 16px;
                padding: 12px;
            }

            .gif-container {
                max-width: 175px;
            }
            
            .gif-container .bubu-gif {
                max-width: 175px;
            }

            #phase2 {
                margin: -20px -15px;
                padding: 0;
            }
            
            #phase2 .question {
                padding: 0 15px 10px 15px;
                margin-top: 8px;
            }
            
            #phase2 .hint-message {
                padding: 0 15px;
            }
            
            #phase2 .button-container {
                padding: 0 15px 20px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Hearts Background -->
    <div class="floating-hearts" id="floating-hearts"></div>

    <!-- Audio Controls -->
    <div class="audio-controls">
        <button class="mute-btn" id="mute-btn" title="Toggle Sound">ğŸ”Š</button>
    </div>

    <div class="container">
        <div class="card fade-in">
            <!-- Phase 1: German Quiz -->
            <div id="phase1" class="phase active">
                <h1>German Vocabulary Practice: Level 1</h1>
                <div class="question" id="question-text"></div>
                <div class="options" id="options"></div>
            </div>

            <!-- Loading State -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading Next Level...</div>
            </div>

            <!-- Phase 2: Proposal -->
            <div id="phase2" class="phase">
                <!-- Animated GIF Container -->
                <div class="gif-container" id="gif-container">
                    <img src="gifs/bubu-dudu-flower-gift.gif" alt="Bubu Dudu with flowers" id="tenor-gif-1" class="bubu-gif">
                    
                    <img src="gifs/yier-dudu.gif" alt="Dudu with sunglasses" id="tenor-gif-2" class="bubu-gif hidden">
                    
                    <img src="gifs/sseeyall-bubu-dudu.gif" alt="Loving Bubu Dudu" id="tenor-gif-3" class="bubu-gif hidden">
                    
                    <img src="gifs/bubu-dudu-seeyall.gif" alt="Bubu Dudu seeyall" id="tenor-gif-4" class="bubu-gif hidden">
                    
                    <img src="gifs/dudu-playing-voilin-music.gif" alt="Dudu playing violin" id="tenor-gif-5" class="bubu-gif hidden">
                </div>
                
                <div class="question" id="proposal-question"></div>
                <div class="hint-message" id="hint-message"></div>
                <div class="button-container">
                    <div class="options">
                        <button class="ja-btn" id="ja-btn" onclick="acceptProposal()">Ja, natÃ¼rlich!</button>
                        <button class="nein-btn" id="nein-btn">Nein</button>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Success -->
            <div id="phase3" class="phase">
                <div class="success-content">
                    <h1>ğŸ‰ Juhuu! ğŸ‰</h1>
                    <div class="success-image">
                        <img src="IMG_9298.jpg" alt="Our Special Moment" />
                    </div>
                    <div class="success-message">I'm so excited, Bubu! ğŸ’•</div>
                    
                    <div class="love-letter-container show" id="love-letter">
                        <div class="love-letter">
                            Every moment with you feels like magic. You make my heart smile in ways I never knew were possible. I can't wait to spend this special Valentine's Day with you, creating more beautiful memories together. You are my favorite person, my best friend, and the love of my life. Here's to us and all the wonderful adventures that await! â¤ï¸
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Speech Bubble for Nein Button -->
    <div class="speech-bubble" id="speech-bubble"></div>

    <!-- Physics Canvas -->
    <canvas id="physics-canvas"></canvas>

    <!-- Audio Elements -->
    <audio id="bg-music" loop preload="auto">
        <source src="music.m4a" type="audio/mpeg">
    </audio>
    <audio id="success-sound" preload="auto">
        <source src="[SUCCESS_SOUND_URL]" type="audio/mpeg">
    </audio>

    <script>
        // Application State
        const appState = {
            currentPhase: 1,
            currentQuestion: 1,
            physicsActive: false,
            neinAttempts: 0,
            audioMuted: false,
            buttonScale: 1,
            audioUnlocked: false,
            currentGif: 1,
            neinClickCount: 0,
            jaHoverCount: 0,
            neinHoverCount: 0
        };

        // Quiz data - German vocabulary questions
        const quizQuestions = {
            1: {
                question: "What is 'Das Herz'?",
                options: ["The House", "The Heart"],
                correct: "The Heart"
            },
            2: {
                question: "What is 'FÃ¼r immer'?",
                options: ["Forever", "Never"],
                correct: "Forever"
            }
        };

        // Cheeky messages for Nein button
        const cheekyMessages = [
            "You sure? ğŸ˜",
            "Really? ğŸ¤”",
            "Think again! ğŸ’­",
            "Nope! ğŸ˜œ",
            "Not today! ğŸ™ˆ",
            "Try the green one! ğŸ’š",
            "Wrong button! âŒ",
            "Are you testing me? ğŸ˜…"
        ];

        // Cheeky messages for Ja button
        const jaMessages = [
            "Yes! This one! ğŸ’š",
            "Perfect choice! ğŸ˜Š",
            "You know you want to! ğŸ’•",
            "The right button! âœ¨",
            "Smart decision! ğŸ¥°",
            "I knew it! ğŸ’–",
            "Go ahead, click me! ğŸ˜‰"
        ];

        const hintMessages = [
            "",
            "",
            "",
            "",
            "",
            "The heart wants what it wants... ğŸ’•",
            "The heart wants what it wants... ğŸ’•",
            "The heart wants what it wants... ğŸ’•",
            "The heart wants what it wants... ğŸ’•",
            "The heart wants what it wants... ğŸ’•",
            "Just click the green one! You know you want to! ğŸ˜Š"
        ];

        let lastJaMessageTime = 0;
        let jaMessageShowing = false;
        let currentJaMessage = '';
        let jaBubbleTimeout = null;

        // Initialize floating hearts and flowers
        function createFloatingHearts() {
            const heartsContainer = document.getElementById('floating-hearts');
            const hearts = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’', 'â¤ï¸'];
            const flowers = ['ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¹', 'ğŸŒ·', 'ğŸ’', 'ğŸŒ¼'];
            
            // Create hearts
            for (let i = 0; i < 12; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.setProperty('--drift', (Math.random() - 0.5) * 2);
                heart.style.animationDelay = Math.random() * 15 + 's';
                heartsContainer.appendChild(heart);
            }
            
            // Create flowers
            for (let i = 0; i < 10; i++) {
                const flower = document.createElement('div');
                flower.className = 'flower';
                flower.textContent = flowers[Math.floor(Math.random() * flowers.length)];
                flower.style.left = Math.random() * 100 + '%';
                flower.style.setProperty('--drift', (Math.random() - 0.5) * 2);
                flower.style.animationDelay = Math.random() * 15 + 's';
                heartsContainer.appendChild(flower);
            }
        }

        // Display text directly (no typewriter effect)
        function displayText(element, text) {
            element.textContent = text;
        }

        // Unlock audio for iOS (must be called on user interaction)
        function unlockAudio() {
            if (appState.audioUnlocked) return;
            
            const bgMusic = document.getElementById('bg-music');
            
            // Create a silent playback to unlock audio on iOS
            bgMusic.volume = 0;
            const playPromise = bgMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    bgMusic.pause();
                    bgMusic.currentTime = 0;
                    bgMusic.volume = 0.5;
                    appState.audioUnlocked = true;
                    console.log('Audio unlocked for iOS');
                }).catch(err => {
                    console.log('Audio unlock failed:', err);
                });
            }
        }

        // Switch GIF based on interaction
        function switchGif(gifNumber) {
            if (appState.currentGif === gifNumber) return;
            
            // Hide all GIFs
            for (let i = 1; i <= 5; i++) {
                const gif = document.getElementById(`tenor-gif-${i}`);
                if (gif) {
                    gif.classList.add('hidden');
                }
            }
            
            // Show the target GIF
            const targetGif = document.getElementById(`tenor-gif-${gifNumber}`);
            if (targetGif) {
                targetGif.classList.remove('hidden');
                appState.currentGif = gifNumber;
            }
        }

        // Phase 1: Quiz Logic
        function startQuiz() {
            const q = quizQuestions[appState.currentQuestion];
            const questionEl = document.getElementById('question-text');
            
            displayText(questionEl, q.question);
            
            // Show options
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => answerQuestion(option);
                optionsContainer.appendChild(btn);
            });
        }

        function answerQuestion(answer) {
            // Unlock audio on first user interaction (iOS fix)
            unlockAudio();
            
            const currentQ = quizQuestions[appState.currentQuestion];
            
            if (answer === currentQ.correct) {
                if (appState.currentQuestion === 1) {
                    // Move to question 2
                    appState.currentQuestion = 2;
                    startQuiz();
                } else if (appState.currentQuestion === 2) {
                    // Transition to Phase 2
                    showLoading();
                    setTimeout(() => {
                        hideLoading();
                        transitionToPhase2();
                    }, 1500);
                }
            } else {
                // Wrong answer - shake effect
                const card = document.querySelector('.card');
                card.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    card.style.animation = '';
                }, 500);
            }
        }

        function showLoading() {
            document.getElementById('phase1').classList.remove('active');
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        // Phase 2: Proposal with Button Interactions
        let lastMessageTime = 0;
        
        function transitionToPhase2() {
            appState.currentPhase = 2;
            document.getElementById('phase2').classList.add('active');
            
            // Show floating hearts for romantic effect
            document.getElementById('floating-hearts').classList.add('show');
            
            // Start playing romantic background music
            if (!appState.audioMuted && appState.audioUnlocked) {
                const bgMusic = document.getElementById('bg-music');
                bgMusic.volume = 0.5; // Set volume to 50%
                bgMusic.currentTime = 0; // Start from beginning
                
                const playPromise = bgMusic.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => {
                        console.log('Audio playback failed:', err);
                        // Show a hint to user if audio fails
                        console.log('Tap the screen if audio doesn\'t play');
                    });
                }
            }
            
            // Display the proposal question
            const proposalText = "Willst du mein Valentin sein, Neha?";
            displayText(document.getElementById('proposal-question'), proposalText);
            
            // Setup button interactions
            setupButtonInteractions();
        }

        function setupButtonInteractions() {
            const neinBtn = document.getElementById('nein-btn');
            
            // Nein button hover - shrink effect
            neinBtn.addEventListener('mouseenter', handleNeinHover);
            
            // Track mouse movement for GIF changes
            document.addEventListener('mousemove', handleMouseMoveForGif);
        }

        function handleNeinHover() {
            const neinBtn = document.getElementById('nein-btn');
            appState.neinHoverCount++;
            
            // Add shrinking animation
            neinBtn.classList.add('shrinking');
            setTimeout(() => {
                neinBtn.classList.remove('shrinking');
            }, 300);
            
            // Calculate new scale based on hover count
            const shrinkFactor = Math.max(0.5, 1 - (appState.neinHoverCount * 0.08));
            neinBtn.style.transform = `scale(${shrinkFactor})`;
            
            // Show cheeky message
            const now = Date.now();
            if (now - lastMessageTime > 1500) {
                showSpeechBubble(cheekyMessages[Math.floor(Math.random() * cheekyMessages.length)]);
                lastMessageTime = now;
            }
            
            // Update hint message after multiple attempts
            const hintMsg = document.getElementById('hint-message');
            if (appState.neinHoverCount >= 5) {
                hintMsg.textContent = hintMessages[Math.min(appState.neinHoverCount, hintMessages.length - 1)];
                hintMsg.classList.add('show');
            }
        }

        function handleMouseMoveForGif(event) {
            if (appState.currentPhase !== 2) return;
            
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            
            let isNearAnyButton = false;
            
            // Check distance to Ja button
            const jaBtn = document.querySelector('.ja-btn');
            if (jaBtn) {
                const jaBtnRect = jaBtn.getBoundingClientRect();
                const jaCenterX = jaBtnRect.left + jaBtnRect.width / 2;
                const jaCenterY = jaBtnRect.top + jaBtnRect.height / 2;
                const jaDistance = Math.sqrt(
                    Math.pow(jaCenterX - mouseX, 2) + 
                    Math.pow(jaCenterY - mouseY, 2)
                );
                
                if (jaDistance < 120) {
                    isNearAnyButton = true;
                    
                    // Change GIF when hovering near Ja button
                    if (appState.neinHoverCount >= 5) {
                        switchGif(5); // Playing violin after multiple Nein attempts
                    } else if (appState.neinHoverCount > 0) {
                        switchGif(5); // Playing violin
                    } else {
                        switchGif(3); // First hover on Ja - loving Bubu Dudu
                    }
                    
                    // Show encouraging message
                    const now = Date.now();
                    if (!jaMessageShowing || now - lastJaMessageTime > 2000) {
                        const newMessage = jaMessages[Math.floor(Math.random() * jaMessages.length)];
                        if (newMessage !== currentJaMessage || !jaMessageShowing) {
                            showJaSpeechBubble(newMessage, jaCenterX, jaCenterY);
                            currentJaMessage = newMessage;
                            lastJaMessageTime = now;
                        }
                    }
                } else {
                    if (jaMessageShowing) {
                        hideJaSpeechBubble();
                    }
                }
            }
            
            // Check distance to Nein button
            const neinBtn = document.getElementById('nein-btn');
            if (neinBtn) {
                const neinBtnRect = neinBtn.getBoundingClientRect();
                const neinCenterX = neinBtnRect.left + neinBtnRect.width / 2;
                const neinCenterY = neinBtnRect.top + neinBtnRect.height / 2;
                const neinDistance = Math.sqrt(
                    Math.pow(neinCenterX - mouseX, 2) + 
                    Math.pow(neinCenterY - mouseY, 2)
                );
                
                if (neinDistance < 100) {
                    isNearAnyButton = true;
                    
                    // Change GIF based on hover count
                    if (appState.neinHoverCount < 5) {
                        switchGif(2); // Sunglasses Dudu
                    } else {
                        switchGif(4); // Persistent Dudu
                    }
                }
            }
            
            // If not near any button, show default flower gift GIF
            if (!isNearAnyButton) {
                switchGif(1); // Default: flower gift
            }
        }

        function showSpeechBubble(message) {
            const bubble = document.getElementById('speech-bubble');
            const neinBtn = document.getElementById('nein-btn');
            const rect = neinBtn.getBoundingClientRect();
            
            bubble.textContent = message;
            bubble.style.left = (rect.left + rect.width / 2) + 'px';
            bubble.style.top = (rect.top - 60) + 'px';
            bubble.style.background = 'white';
            bubble.style.color = '#FF1744';
            bubble.classList.add('show');
            
            setTimeout(() => {
                bubble.classList.remove('show');
            }, 1000);
        }

        function showJaSpeechBubble(message, x, y) {
            // Clear any existing timeout
            if (jaBubbleTimeout) {
                clearTimeout(jaBubbleTimeout);
            }
            
            const bubble = document.getElementById('speech-bubble');
            bubble.textContent = message;
            bubble.style.left = x + 'px';
            bubble.style.top = (y - 60) + 'px';
            bubble.style.background = 'white';
            bubble.style.color = '#00C853';
            bubble.classList.add('show');
            jaMessageShowing = true;
        }

        function hideJaSpeechBubble() {
            const bubble = document.getElementById('speech-bubble');
            bubble.classList.remove('show');
            jaMessageShowing = false;
            currentJaMessage = '';
        }

        // Phase 3: Success with Enhanced Confetti
        function acceptProposal() {
            // Ensure audio is unlocked (backup for iOS)
            unlockAudio();
            
            // Stop any ongoing interactions
            appState.currentPhase = 3;
            
            // Play success sound
            if (!appState.audioMuted) {
                const successSound = document.getElementById('success-sound');
                successSound.play().catch(() => {});
            }
            
            // Heart-shaped confetti explosion
            const duration = 5000;
            const animationEnd = Date.now() + duration;
            
            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }
            
            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                
                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }
                
                const particleCount = 50 * (timeLeft / duration);
                
                // Heart confetti
                confetti({
                    particleCount,
                    startVelocity: 30,
                    spread: 360,
                    ticks: 60,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                    colors: ['#FF1493', '#FF69B4', '#FFB6C1', '#FFC0CB', '#FF1744'],
                    shapes: ['circle', 'square'],
                    scalar: randomInRange(0.8, 1.2),
                    zIndex: 9999
                });
                
                confetti({
                    particleCount,
                    startVelocity: 30,
                    spread: 360,
                    ticks: 60,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                    colors: ['#FF1493', '#FF69B4', '#FFB6C1', '#FFC0CB', '#FF1744'],
                    shapes: ['circle', 'square'],
                    scalar: randomInRange(0.8, 1.2),
                    zIndex: 9999
                });
            }, 250);
            
            // Transition to success phase
            appState.currentPhase = 3;
            document.getElementById('phase2').classList.remove('active');
            document.getElementById('phase3').classList.add('active');
        }

        // Audio controls
        function toggleAudio() {
            // Unlock audio on first interaction (iOS fix)
            if (!appState.audioUnlocked) {
                unlockAudio();
            }
            
            appState.audioMuted = !appState.audioMuted;
            const bgMusic = document.getElementById('bg-music');
            const muteBtn = document.getElementById('mute-btn');
            
            if (appState.audioMuted) {
                bgMusic.pause();
                muteBtn.textContent = 'ğŸ”‡';
            } else {
                bgMusic.volume = 0.5;
                bgMusic.play().catch(() => {});
                muteBtn.textContent = 'ğŸ”Š';
            }
        }

        // Initialize app
        window.addEventListener('load', () => {
            console.log('Valentine Experience Loaded! ğŸ’•');
            createFloatingHearts();
            startQuiz();
            
            // Setup audio controls
            document.getElementById('mute-btn').addEventListener('click', toggleAudio);
            
            // Background music will start when Phase 2 begins (after quiz)
        });
    </script>
</body>
</html>
